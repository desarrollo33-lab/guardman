---
/**
 * Hero Section - Monochromatic Design
 * Clean, minimal hero with video background.
 * Design inspired by Porsche and Ajax Systems.
 */

import Button from '@/components/ui/Button.astro';
import Container from '@/components/ui/Container.astro';
import Icon from '@/components/ui/Icon.astro';

interface Props {
  title?: string;
  subtitle?: string;
  primaryCta?: {
    text: string;
    href: string;
  };
  secondaryCtas?: Array<{
    text: string;
    href: string;
    variant?: 'primary' | 'secondary' | 'outline' | 'accent';
  }>;
  trustBadges?: Array<{
    text: string;
    icon?: string;
  }>;
  data?: {
    primary_cta?: { text: string; href: string };
    secondary_ctas?: Array<{
      text: string;
      href: string;
      variant?: 'primary' | 'secondary' | 'outline' | 'accent';
    }>;
    trust_badges?: Array<{ text: string; icon?: string }>;
    background_type?: 'youtube' | 'image';
    youtube_id?: string;
    video_id?: string; // Legacy prop for backward compatibility
    image_url?: string;
    mobile_image_url?: string;
  } | null;
}

const {
  title = 'Seguridad Premium para tu Empresa',
  subtitle = 'Guardias certificados, tecnología de vanguardia y protección integral sin contratos forzosos',
  data,
} = Astro.props;

const primaryCta = data?.primary_cta || {
  text: 'Cotizar',
  href: '/cotizar',
};

const secondaryCtas = data?.secondary_ctas || [
  { text: 'Servicios', href: '/servicios', variant: 'outline' },
];

const trustBadges = data?.trust_badges || [
  { text: 'Ley 21.659', icon: 'shield-check' },
  { text: 'OS10 Certificado', icon: 'badge-check' },
  { text: '+500 Clientes', icon: 'users' },
];

// Background configuration with backward compatibility
// Priority: youtube_id > video_id (legacy) > default
const backgroundType = data?.background_type || 'youtube';
const videoId = data?.youtube_id || data?.video_id || 'r6OSTXanzmI';
const imageUrl = data?.image_url || '';
const mobileImageUrl = data?.mobile_image_url || '';

// Fallback chain for mobile image: mobile_image_url > image_url > YouTube poster
const getMobileImageSrc = () => {
  if (mobileImageUrl) return mobileImageUrl;
  if (imageUrl) return imageUrl;
  // Fallback to YouTube poster image
  return `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
};

const mobileImageSrc = getMobileImageSrc();

---

<section
  class="relative min-h-[100vh] md:min-h-[90vh] flex items-center overflow-hidden bg-black"
>
  {/* Background Layer */}
  <div class="absolute inset-0 z-0">
    {/* Mobile: Static Image Background */}
    <div class="block md:hidden absolute inset-0 w-full h-full">
      <img
        src={mobileImageSrc}
        alt="Guardman seguridad"
        class="w-full h-full object-cover"
        loading="eager"
      />
    </div>
    
    {/* Desktop: YouTube Video Background */}
    <div class="hidden md:block absolute inset-0 w-full h-full overflow-hidden">
      {backgroundType === 'youtube' && (
        <iframe
          src={`https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&loop=1&playlist=${videoId}&controls=0&showinfo=0&rel=0&modestbranding=1&iv_load_policy=3&disablekb=1&fs=0&playsinline=1&enablejsapi=1`}
          class="absolute top-1/2 left-1/2 min-w-[100vw] min-h-[100vh] w-auto h-auto -translate-x-1/2 -translate-y-1/2 object-cover pointer-events-none"
          style="aspect-ratio: 16/9; min-width: 177.78vh; min-height: 56.25vw;"
          frameborder="0"
          allow="autoplay; encrypted-media"
          allowfullscreen="false"
          loading="lazy"
          title="Video de fondo Guardman"
        ></iframe>
      )}
      {backgroundType === 'image' && imageUrl && (
        <img
          src={imageUrl}
          alt="Guardman seguridad"
          class="w-full h-full object-cover"
          loading="eager"
        />
      )}
    </div>
    
    {/* Dark Overlay */}
    <div class="absolute inset-0 bg-black/70"></div>
  </div>

  {/* Content */}
  <Container class="relative z-10 py-20 md:py-28">
    <div class="max-w-4xl">
      {/* Main Headline */}
      <h1 class="text-4xl sm:text-5xl lg:text-6xl xl:text-7xl font-semibold text-white mb-6 tracking-tight leading-[1.1]">
        {title}
      </h1>

      {/* Subheadline */}
      <p class="text-lg sm:text-xl lg:text-2xl text-white/70 max-w-2xl mb-10 leading-relaxed">
        {subtitle}
      </p>

      {/* CTAs */}
      <div class="flex flex-col sm:flex-row gap-4 mb-12">
        <Button
          href={primaryCta.href}
          variant="accent"
          size="lg"
          class="text-base sm:text-lg font-medium bg-white text-black hover:bg-gray-100"
        >
          {primaryCta.text}
        </Button>

        {
          secondaryCtas.map((cta) => (
            <Button
              href={cta.href}
              variant={cta.variant || 'outline'}
              size="lg"
              class="text-base sm:text-lg border-white/40 text-white hover:bg-white hover:text-black"
            >
              {cta.text}
            </Button>
          ))
        }
      </div>

      {/* Trust Badges */}
      <div class="flex flex-wrap items-center gap-6 md:gap-10">
        {
          trustBadges.map((badge) => (
            <div class="flex items-center gap-3 text-white/60 text-sm font-medium">
              <Icon name={badge.icon || 'shield-check'} size="md" color="white" />
              <span>{badge.text}</span>
            </div>
          ))
        }
      </div>
    </div>
  </Container>

  {/* Scroll Indicator */}
  <div class="absolute bottom-8 left-1/2 -translate-x-1/2 z-10 animate-bounce hidden md:block">
    <a
      href="#service-finder"
      class="flex flex-col items-center gap-2 text-white/40 hover:text-white/70 transition-colors"
    >
      <Icon name="chevron-down" size="lg" color="white" />
    </a>
  </div>
</section>
