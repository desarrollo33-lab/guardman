---
/**
 * LocalBusiness Schema Component
 * JSON-LD structured data for local business (per commune)
 */
import { site } from '@/data/site';

interface Props {
  city: string;
  region?: string;
  slug: string;
  services?: string[];
  telephone?: string;
  email?: string;
  latitude?: string;
  longitude?: string;
}

const {
  city,
  region = site.address.region,
  slug,
  services: serviceNames = [],
  telephone = site.phone,
  email = site.email,
  latitude,
  longitude,
} = Astro.props;

const name = `${site.name} ${city}`;
const url = new URL(`/cobertura/${slug}`, site.url).href;
const description = `Servicios de seguridad privada en ${city}, ${region}. Guardias de seguridad, vigilancia y monitoreo para empresas. Guardman Chile.`;

const schema: Record<string, unknown> = {
  '@context': 'https://schema.org',
  '@type': 'LocalBusiness',
  '@id': url,
  name,
  url,
  telephone,
  email,
  description,
  priceRange: '$$',
  openingHours: 'Mo-Su 00:00-23:59',
  address: {
    '@type': 'PostalAddress',
    streetAddress: `${site.address.street}, ${city}`,
    addressLocality: city,
    addressRegion: region,
    postalCode: site.address.postalCode,
    addressCountry: 'CL',
  },
  areaServed: {
    '@type': 'City',
    name: city,
    containedInPlace: {
      '@type': 'State',
      name: region,
    },
  },
  sameAs: [
    site.social.instagram,
    site.social.linkedin,
    site.social.youtube,
  ],
};

// Add hasOfferCatalog if services are provided
if (serviceNames && serviceNames.length > 0) {
  schema.hasOfferCatalog = {
    '@type': 'OfferCatalog',
    name: `Servicios de Seguridad en ${city}`,
    itemListElement: serviceNames.map((s: string) => ({
      '@type': 'Offer',
      itemOffered: {
        '@type': 'Service',
        name: s,
      },
    })),
  };
}

// Only include geo coordinates if provided
if (latitude && longitude) {
  schema.geo = {
    '@type': 'GeoCoordinates',
    latitude,
    longitude,
  };
}
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />
