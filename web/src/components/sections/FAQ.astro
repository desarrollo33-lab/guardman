---
/**
 * FAQ Section - Monochromatic Design
 * Interactive accordion FAQ with category tabs and Schema.org structured data.
 * Minimal, clean design inspired by Porsche.com and Ajax.systems.
 */

import Container from '@/components/ui/Container.astro';
import Section from '@/components/ui/Section.astro';
import FAQSchema from '@/components/seo/FAQSchema.astro';
import Icon from '@/components/ui/Icon.astro';

interface FAQItem {
  id: string;
  question: string;
  answer: string;
  category?: string;
}

interface Props {
  faqs: FAQItem[];
  title?: string;
  subtitle?: string;
  maxItems?: number;
  background?: 'white' | 'gray' | 'primary' | 'dark';
  showSchema?: boolean;
}

const {
  faqs,
  title = 'Preguntas Frecuentes',
  subtitle = 'Resolvemos tus dudas sobre nuestros servicios de seguridad',
  maxItems,
  background = 'gray',
  showSchema = true,
} = Astro.props;

const displayFaqs = maxItems ? faqs.slice(0, maxItems) : faqs;

// FAQ Categories with icons (using Heroicons names)
const categories = [
  { id: 'all', name: 'Todos', icon: 'magnifying' },
  { id: 'guardias', name: 'Guardias', icon: 'shield-check' },
  { id: 'alarmas', name: 'Alarmas', icon: 'bell-alert' },
  { id: 'guardpod', name: 'GuardPod', icon: 'signal' },
  { id: 'drones', name: 'Drones', icon: 'airplane' },
  { id: 'empresa', name: 'Empresa', icon: 'building' },
];
---

<Section id="faq" background={background}>
  <Container>
    {/* Section Header */}
    <div class="text-center mb-8 md:mb-12">
      <h2 class="text-3xl md:text-4xl font-semibold text-gray-900 mb-4 tracking-tight">
        {title}
      </h2>
    </div>

    {/* Category Tabs */}
    <div class="flex flex-wrap justify-center gap-2 md:gap-3 mb-10" id="faq-tabs">
      {categories.map((cat, index) => (
        <button
          class={`faq-tab inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 ${
            cat.id === 'all' 
              ? 'bg-gray-900 text-white' 
              : 'bg-white text-gray-600 hover:bg-gray-100 border border-gray-200'
          }`}
          data-category={cat.id}
        >
          <Icon name={cat.icon} size="sm" color={cat.id === 'all' ? 'white' : 'gray'} />
          {cat.name}
        </button>
      ))}
    </div>

    {/* FAQ Accordion */}
    <div class="max-w-3xl mx-auto">
      <div class="space-y-3" id="faq-accordion">
        {
          displayFaqs.map((faq, index) => (
            <div
              class="faq-item bg-white rounded-xl border border-gray-200 overflow-hidden transition-all duration-200 hover:border-gray-400"
              data-faq-id={faq.id}
              data-category={faq.category || 'all'}
            >
              {/* Question Button */}
              <button
                class="faq-trigger w-full flex items-center justify-between p-5 md:p-6 text-left group"
                aria-expanded="false"
                aria-controls={`faq-answer-${faq.id}`}
              >
                <span class="font-semibold text-gray-900 group-hover:text-gray-600 transition-colors pr-4 text-base md:text-lg">
                  {faq.question}
                </span>
                <span class="faq-icon flex-shrink-0 text-gray-400 group-hover:text-gray-600 transition-all">
                  <Icon name="chevron-down" size="md" />
                </span>
              </button>

              {/* Answer Panel */}
              <div
                id={`faq-answer-${faq.id}`}
                class="faq-panel hidden"
                role="region"
              >
                <div class="px-5 md:px-6 pb-5 md:pb-6 pt-0">
                  <div class="border-t border-gray-100 pt-4">
                    <p class="text-gray-600 leading-relaxed">{faq.answer}</p>
                  </div>
                </div>
              </div>
            </div>
          ))
        }
      </div>

      {/* Contact CTA */}
      <div class="mt-10 text-center">
        <p class="text-gray-500 mb-4">¿Tienes más preguntas?</p>
        <a
          href="https://wa.me/56930000010?text=Hola,%20tengo%20una%20pregunta%20sobre%20sus%20servicios"
          class="inline-flex items-center gap-2 px-6 py-3 bg-gray-900 hover:bg-gray-800 text-white font-semibold rounded-lg transition-all"
          target="_blank"
          rel="noopener noreferrer"
        >
          <Icon name="chat-bubble-left" size="sm" color="white" />
          Consultar por WhatsApp
        </a>
      </div>
    </div>
  </Container>
</Section>

{/* Schema.org FAQ Structured Data */}
{
  showSchema && (
    <FAQSchema
      faqs={displayFaqs.map((f) => ({
        question: f.question,
        answer: f.answer,
      }))}
    />
  )
}

<script>
  // FAQ Accordion & Tab Functionality
  document.addEventListener('DOMContentLoaded', () => {
    const accordion = document.getElementById('faq-accordion');
    const tabsContainer = document.getElementById('faq-tabs');
    if (!accordion || !tabsContainer) return;

    const triggers = accordion.querySelectorAll('.faq-trigger');
    const tabs = tabsContainer.querySelectorAll('.faq-tab');
    const items = accordion.querySelectorAll('.faq-item');

    // Tab functionality
    tabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        const category = (tab as HTMLElement).dataset.category;

        // Update tab styles
        tabs.forEach((t) => {
          if (t === tab) {
            t.classList.remove('bg-white', 'text-gray-600', 'border', 'border-gray-200', 'hover:bg-gray-100');
            t.classList.add('bg-gray-900', 'text-white');
          } else {
            t.classList.remove('bg-gray-900', 'text-white');
            t.classList.add('bg-white', 'text-gray-600', 'border', 'border-gray-200', 'hover:bg-gray-100');
          }
        });

        // Filter FAQ items
        items.forEach((item) => {
          const itemCategory = (item as HTMLElement).dataset.category;
          if (category === 'all' || itemCategory === category) {
            (item as HTMLElement).style.display = 'block';
          } else {
            (item as HTMLElement).style.display = 'none';
          }
        });
      });
    });

    // Accordion functionality
    triggers.forEach((trigger) => {
      trigger.addEventListener('click', () => {
        const item = trigger.closest('.faq-item');
        const panel = item?.querySelector('.faq-panel') as HTMLElement;
        const icon = trigger.querySelector('.faq-icon svg') as SVGElement;
        const isExpanded = trigger.getAttribute('aria-expanded') === 'true';

        // Close all other panels
        triggers.forEach((otherTrigger) => {
          if (otherTrigger !== trigger) {
            const otherItem = otherTrigger.closest('.faq-item');
            const otherPanel = otherItem?.querySelector(
              '.faq-panel'
            ) as HTMLElement;
            const otherIcon = otherTrigger.querySelector(
              '.faq-icon svg'
            ) as SVGElement;

            otherTrigger.setAttribute('aria-expanded', 'false');
            if (otherPanel) {
              otherPanel.classList.add('hidden');
            }
            if (otherIcon) {
              otherIcon.style.transform = 'rotate(0deg)';
            }
          }
        });

        // Toggle current panel
        trigger.setAttribute('aria-expanded', String(!isExpanded));
        if (panel) {
          panel.classList.toggle('hidden', isExpanded);
        }
        if (icon) {
          icon.style.transform = isExpanded ? 'rotate(0deg)' : 'rotate(180deg)';
        }
      });
    });
  });
</script>
