---
/**
 * Área de Servicio - Región Metropolitana
 * Hub page for RM-only coverage zones
 */

import BaseLayout from '@/layouts/BaseLayout.astro';
import Container from '@/components/ui/Container.astro';
import Section from '@/components/ui/Section.astro';
import Button from '@/components/ui/Button.astro';
import Icon from '@/components/ui/Icon.astro';
import Breadcrumbs from '@/components/ui/Breadcrumbs.astro';
import { convexServer } from '@/lib/convex';
import { api } from '@convex/_generated/api';
import { site } from '@/data/site';
import { generateBreadcrumbSchema } from '@/utils/seo';

type Zone = 'norte' | 'sur' | 'oriente' | 'poniente' | 'centro';
const allCommunes = await convexServer.query(api.locations.getAllCommunes);
const communes = allCommunes;
const getCommunesByZone = (zone: Zone) => allCommunes.filter((c: any) => c.zone === zone);

const title = 'Cobertura en 52 Comunas de Santiago y RM | Guardman Chile';
const description =
  'Seguridad privada en toda la Región Metropolitana ✓ 50+ comunas ✓ Respuesta 15 min ✓ Solicita tu cotización gratis';

const breadcrumbSchema = generateBreadcrumbSchema([
  { name: 'Inicio', url: '/' },
  { name: 'Área de Servicio', url: '/cobertura' },
]);

// Zone configuration with minimal styling for lists
const zoneLabels: Record<Zone, string> = {
  norte: 'Zona Norte',
  centro: 'Zona Centro',
  oriente: 'Zona Oriente',
  poniente: 'Zona Poniente',
  sur: 'Zona Sur',
};

// Get communes by zone
const zones: Zone[] = ['norte', 'centro', 'oriente', 'poniente', 'sur'];
const totalCommunes = communes.length;

// Stats for the page
const stats = [
  { value: '1', label: 'Región' },
  { value: totalCommunes.toString(), label: 'Comunas' },
  { value: '24/7', label: 'Cobertura' },
  { value: '15min', label: 'Respuesta' },
];
---

<BaseLayout title={title} description={description} schema={breadcrumbSchema}>
  <!-- Hero Section -->
  <section class="relative overflow-hidden bg-black py-20 md:py-32">
    <!-- Background layer -->
    <div class="absolute inset-0 z-0">
      <div class="absolute inset-0 bg-black/85 z-10"></div>
      <img 
        src="https://images.unsplash.com/photo-1544006659-f0b21f04cb1d?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80" 
        alt="Cobertura Guardman RM"
        class="w-full h-full object-cover grayscale opacity-30"
      />
    </div>
    
    <Container class="relative z-20">
      <Breadcrumbs items={[{ name: 'Cobertura' }]} />

      <div class="max-w-4xl">
        <!-- Badge -->
        <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/5 border border-white/10 backdrop-blur-sm mb-8">
          <span class="w-1.5 h-1.5 rounded-full bg-white animate-pulse"></span>
          <span class="text-xs text-white/70 uppercase tracking-widest font-medium">Presencia Nacional - Región Metropolitana</span>
        </div>
        
        <h1 class="text-4xl md:text-6xl lg:text-7xl font-semibold text-white mb-6 tracking-tight leading-[1.1]">
          Área de<br/>
          <span class="text-white/40 italic">Servicio</span>
        </h1>

        <p class="text-lg md:text-xl text-white/60 mb-10 max-w-2xl leading-relaxed">
          Despliegue táctico y cobertura integral en las {totalCommunes} comunas de la capital. 
          Protección de alto estándar con respuesta coordinada 24/7.
        </p>

        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-8 mt-12 pt-12 border-t border-white/10">
          {stats.map((stat) => (
            <div class="group">
              <div class="text-3xl md:text-4xl font-semibold text-white mb-1 tabular-nums tracking-tight group-hover:text-white transition-colors">
                {stat.value}
              </div>
              <div class="text-[10px] text-white/40 uppercase tracking-[0.3em] font-medium">
                {stat.label}
              </div>
            </div>
          ))}
        </div>
      </div>
    </Container>
  </section>

  <!-- Communes by Zone -->
  <Section background="white" class="pt-0">
    <Container size="lg">
      <div class="mb-16">
        <h2 class="text-3xl md:text-5xl font-semibold text-gray-900 mb-6 tracking-tight">
          Presencia por Zona
        </h2>
        <p class="text-gray-500 text-lg max-w-2xl leading-relaxed">
          Operamos de manera estratégica dividiendo la capital en sectores clave para garantizar 
          disponibilidad inmediata y conocimiento local del terreno.
        </p>
      </div>

      <div class="space-y-20">
        {zones.map((zone) => {
          const communesInZone = getCommunesByZone(zone);
          return (
            <div class="group">
              <!-- Zone header -->
              <div class="flex items-center gap-6 mb-10 pb-6 border-b border-gray-100">
                <div class="w-12 h-12 flex items-center justify-center bg-gray-900 text-white rounded-lg">
                  <Icon name="map-pin" size="sm" />
                </div>
                <div>
                  <h3 class="text-xl font-bold text-gray-900 uppercase tracking-widest">
                    {zoneLabels[zone]}
                  </h3>
                  <p class="text-xs text-gray-400 font-bold uppercase tracking-[0.2em] mt-1">
                    {communesInZone.length} Comunas bajo vigilancia
                  </p>
                </div>
              </div>
              
              <!-- Communes grid -->
              <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                {communesInZone.map((commune) => (
                  <a
                    href={`/cobertura/${commune.slug}`}
                    class="group/item flex items-center justify-between px-5 py-4 bg-gray-50 rounded-lg hover:bg-black transition-all duration-300"
                  >
                    <span class="font-medium text-gray-700 group-hover/item:text-white transition-colors">
                      {commune.name}
                    </span>
                    <Icon 
                      name="arrow-right" 
                      size="xs" 
                      class="text-gray-300 group-hover/item:text-white group-hover/item:translate-x-1 transition-all"
                    />
                  </a>
                ))}
              </div>
            </div>
          );
        })}
      </div>
    </Container>
  </Section>

  <!-- CTA Section -->
  <Section background="dark" class="relative overflow-hidden">
    <Container>
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-3xl md:text-5xl font-semibold text-white mb-8 tracking-tight">
          Protección operativa en su comuna
        </h2>
        
        <p class="text-lg md:text-xl text-white/50 mb-12 max-w-2xl mx-auto leading-relaxed">
          Nuestros equipos tácticos están listos para desplegarse. 
          Consulte por soluciones de seguridad específicas para su ubicación.
        </p>

        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <Button href="/cotizar" variant="accent" size="lg" class="bg-white text-black hover:bg-gray-100 border-none">
            Solicitar análisis local
            <Icon name="arrow-right" size="sm" class="ml-2" />
          </Button>
          <Button
            href={`tel:${site.phone.replace(/\s/g, '')}`}
            variant="outline"
            size="lg"
            class="border-white/20 hover:bg-white/10 text-white"
          >
            {site.phone}
          </Button>
        </div>
      </div>
    </Container>
  </Section>
</BaseLayout>
