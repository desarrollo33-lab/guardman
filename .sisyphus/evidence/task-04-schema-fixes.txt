# Task 04: Schema Fixes - Evidence Report
# Date: 2026-02-18
# Status: COMPLETED

## Changes Made

### 1. services table - Replaced v.any() with typed validators

Before:
```typescript
services: defineTable(v.any()).index('by_slug', ['slug']),
```

After:
```typescript
services: defineTable({
  id: v.optional(v.string()),
  slug: v.string(),
  title: v.string(),
  description: v.string(),
  tagline: v.optional(v.string()),
  icon: v.optional(v.string()),
  features: v.optional(v.array(v.string())),
  benefits: v.optional(v.array(v.string())),
  cta: v.optional(v.string()),
  solutions: v.optional(v.array(v.string())),
  image: v.optional(v.string()),
  meta_title: v.optional(v.string()),
  meta_description: v.optional(v.string()),
  is_active: v.optional(v.boolean()),
  order: v.optional(v.number()),
}).index('by_slug', ['slug']),
```

### 2. solutions table - Added missing fields

Added:
- image: v.optional(v.string())
- challenges: v.optional(v.array(v.string()))
- relatedServices: v.optional(v.array(v.string()))
- order: v.optional(v.number())

### 3. communes table - Added PSEO fields

Added:
- hero_title: v.optional(v.string())
- hero_subtitle: v.optional(v.string())
- intro_content: v.optional(v.string())

### 4. blog_posts table - Added publishing fields

Added:
- author_id: v.optional(v.string())
- is_published: v.optional(v.boolean())

## Tables Left Unchanged (as intended)

- content_blocks.data remains v.any() - intentional flexibility for component-specific props
- site_config.footer_config remains v.any() - JSON structured footer columns

## Verification

### TypeScript Check
```bash
npx tsc --noEmit convex/schema.ts
```
Result: PASSED (no errors)

### Services Schema (no more v.any())
```
services: defineTable({
  id: v.optional(v.string()),
  slug: v.string(),
  title: v.string(),
  description: v.string(),
  tagline: v.optional(v.string()),
  icon: v.optional(v.string()),
  features: v.optional(v.array(v.string())),
  benefits: v.optional(v.array(v.string())),
  cta: v.optional(v.string()),
  solutions: v.optional(v.array(v.string())),
  image: v.optional(v.string()),
  meta_title: v.optional(v.string()),
  meta_description: v.optional(v.string()),
  is_active: v.optional(v.boolean()),
  order: v.optional(v.number()),
}).index('by_slug', ['slug']),
```

## Notes

- All new fields are optional (migration safety)
- No existing fields renamed or removed
- No existing indexes removed
- Schema matches seed data structures in services.ts and solutions.ts

## Checklist

- [x] services table has typed validators (replaced v.any())
- [x] services has is_active and order fields
- [x] solutions has image field added
- [x] solutions has challenges, relatedServices, is_active, and order fields
- [x] communes has PSEO fields: hero_title, hero_subtitle, intro_content
- [x] blog_posts has is_published field and author_id field
- [x] content_blocks.data remains v.any() (intentional flexibility)
- [x] All existing indexes preserved
- [x] TypeScript check passes
