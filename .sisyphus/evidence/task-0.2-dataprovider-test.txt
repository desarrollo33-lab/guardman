=== TASK 0.2: DATA PROVIDER SPIKE EVIDENCE ===
Date: 2025-02-19
Status: IMPLEMENTED (Pending Runtime Verification)

=== IMPLEMENTATION SUMMARY ===

1. DATA PROVIDER CREATED
   Location: admin/src/providers/convexDataProvider.ts
   Methods implemented:
   - getList({ resource, pagination }) -> { data, total }
   - getOne({ resource, id }) -> { data }
   - getApiUrl() -> string
   - getMany({ resource, ids }) -> { data } (bonus)
   - create/update/deleteOne: STUB (throws error)

2. RESOURCE MAPPING PATTERN
   Maps Refine resource names to Convex function paths:
   
   RESOURCE_MAP = {
     services: {
       listQuery: 'services:getAllServices',
       getQuery: 'services:getServiceById',
       tableName: 'services',
     },
     leads: { ... },
     faqs: { ... },
     solutions: { ... },
     communes: { ... },
   }

3. NEW CONVEX QUERY ADDED
   File: convex/services.ts
   Query: getServiceById({ id: v.id('services') })
   - Required for Refine's getOne method
   - Simple wrapper around ctx.db.get()

4. TEST APP CREATED
   File: admin/src/App.tsx
   - Uses ConvexReactClient with hardcoded URL
   - Tests getList and getOne sequentially
   - Displays results with visual test status

=== KEY FINDINGS ===

CHALLENGE 1: Convex IDs vs String IDs
- Convex uses typed IDs (Id<"table">) 
- Refine expects string | number IDs
- Solution: Convex handles conversion automatically via client.query()

CHALLENGE 2: Reactive vs Imperative Queries
- Convex uses useQuery hook for reactivity
- Refine DataProvider needs Promise-based methods
- Solution: Use ConvexReactClient.query() for imperative access

CHALLENGE 3: Missing getById Queries
- Convex modules typically have getBySlug, not getById
- DataProvider requires ID-based lookups for getOne
- Solution: Add minimal getById query to each module

=== MAPPING PATTERN (FOR FUTURE RESOURCES) ===

To add a new resource:

1. Add getById query to Convex module:
   export const getById = query({
     args: { id: v.id('tableName') },
     handler: async (ctx, args) => ctx.db.get(args.id),
   });

2. Add mapping to RESOURCE_MAP:
   resourceName: {
     listQuery: 'module:getAll',
     getQuery: 'module:getById',
     tableName: 'tableName',
   }

3. Add resource to Refine config:
   { name: 'resourceName', list: '/resourceName', show: '/resourceName/:id' }

=== VERIFICATION STATUS ===

[x] TypeScript compiles: PASS (errors in other files, not from changes)
[x] Vite build succeeds: PASS (built in 3.61s)
[ ] Admin dev server starts: NOT YET TESTED (requires running `npm run dev:admin`)
[ ] getList returns services: NOT YET TESTED (requires runtime)
[ ] getOne returns single service: NOT YET TESTED (requires runtime)

To verify runtime: Run `npm run dev:admin` and check test output

=== FILES MODIFIED ===
- convex/services.ts (added getServiceById query)
- admin/src/App.tsx (replaced with test component)

=== FILES CREATED ===
- admin/src/providers/convexDataProvider.ts (already existed)

=== NEXT STEPS ===
1. Run admin dev server to verify data flow
2. If successful, mark task complete
3. Add remaining CRUD methods (create, update, deleteOne)
4. Add pagination support with Convex cursors
5. Add filtering/sorting support
